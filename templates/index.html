<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwoleMate</title>
    <style>
        #videoElement {
            width: 50%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Welcome to SwoleMate!</h1>
    
    <div>
        <video id="videoElement" autoplay></video>
    </div>

    <div>
        <button id="startButton">Start Video</button>
        <button id="stopButton" disabled>Stop Video</button>
        <button id="saveButton" disabled>Save Video</button> <!-- Save Video button -->
    </div>

    <div>
        <h3>Choose an exercise:</h3>
        <select id="exerciseSelect">
            <option value="shoulder_press">Shoulder Press</option>
            <option value="arm_bicep_curls">Arm Bicep Curls</option>
        </select>
    </div>

    <script>
        const videoElement = document.getElementById('videoElement');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const saveButton = document.getElementById('saveButton');
        let videoStream = null;
        let mediaRecorder = null;
        let recordedChunks = []; // To store recorded video data
        let savedVideo = null;  // Variable to store the video blob when saved

        // Start the video and recording
        startButton.addEventListener('click', function() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    videoElement.srcObject = stream;
                    videoStream = stream;

                    // Create a MediaRecorder instance to record the video
                    mediaRecorder = new MediaRecorder(stream);

                    // When data is available, push it to the recordedChunks array
                    mediaRecorder.ondataavailable = event => {
                        recordedChunks.push(event.data);
                    };

                    // When the recording stops, prepare the video for saving
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(recordedChunks, { type: 'video/webm' });
                        recordedChunks = []; // Clear the recorded data for next time
                        
                        // Store the recorded video in the variable `savedVideo`
                        savedVideo = blob;  // Save the video as a variable
                        console.log('Video saved as variable', savedVideo); // Logs the saved video Blob
                    };

                    mediaRecorder.start(); // Start recording

                    // Disable the start button and enable stop/save buttons
                    startButton.disabled = true;
                    stopButton.disabled = false;
                    saveButton.disabled = false;
                })
                .catch(err => {
                    console.log('Error accessing camera: ' + err);
                });
        });

        // Stop the video and recording
        stopButton.addEventListener('click', function() {
            if (videoStream) {
                const tracks = videoStream.getTracks();
                tracks.forEach(track => track.stop()); // Stop all video tracks
                videoElement.srcObject = null; // Remove video from element
                mediaRecorder.stop(); // Stop recording
                startButton.disabled = false; // Enable the start button
                stopButton.disabled = true; // Disable the stop button
            }
        });

        // Save the recorded video as a variable
        saveButton.addEventListener('click', function() {
            if (savedVideo) {
                console.log('Video saved as a variable:', savedVideo);
                // You can now manipulate or store the `savedVideo` Blob variable as needed
                // For example, you could upload it to a server or process it further in your app
            } else {
                console.log('No video to save.');
            }
        });

        // Handling the dropdown selection (logging the selected exercise)
        const exerciseSelect = document.getElementById('exerciseSelect');
        exerciseSelect.addEventListener('change', function() {
            const selectedExercise = exerciseSelect.value;
            console.log('Selected exercise: ' + selectedExercise);
        });
    </script>
</body>
</html>
